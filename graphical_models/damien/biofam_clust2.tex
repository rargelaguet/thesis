% model-binomial-probit.tex
%

% Augmented Binomial Probit regression model

%\beginpgfgraphicnamed{model-binomial-probit}

\input{colours}


\begin{tikzpicture}
  % Define nodes:
  % matrix factorisation level
  \node[obs]   (Y) {$y_{n,d}^m$};
  \node[latent, above=of Y, xshift=-1.5cm, yshift=0.5cm] (Z) {$z_{n,k}$};
  \node[latent, above=of Y, xshift=1.5cm] (W) {$w_{k,d}^m$};
  \node[latent, xshift=1.5cm] (Tau) {$\tau_{d}^m$};

  \node[opacity=0.4,latent, xshift=-1.5cm] (Tau2) {$\tau_{n}$};

  % parents of Z
  \node[det, above=of Z] (crossZ) {$\times$};
  \node[latent, above=of crossZ] (Zhat) {$\hat{z}_{n,k}^{\ }$};
  \node[latent, above=of Zhat] (SigmaZ) {$\Sigma_k$};
  \node[latent, above=of crossZ, xshift=-1.5cm] (SZ) {$s_{n,k}$};
  \node[latent, above=of SZ] (ThetaZ) {$\theta_{k}$};
  \node[latent, above=of Zhat, xshift=1.5cm, yshift=0.8cm] (muZ) {$\mu_{k, c}$};

  % parents of W
  \node[det, above=of W] (crossW) {$\times$};
  \node[latent, above=of crossW] (What) {$\hat{w}_{k,d}^m$};
  \node[latent, above=of What] (SigmaW) {$\Sigma_k^m$};
  \node[latent, above=of crossW, xshift=1.5cm] (SW) {$s_{k,d}^m$};
  \node[latent, above=of SW] (ThetaW) {$\theta_{k}^m$};
  \node[latent, above=of What, xshift=-1.5cm] (muW) {$\mu^m_{k, c}$};

  % Connect the nodes
  \edge {Z,W, Tau} {Y}; %
  \edge {ThetaZ} {SZ};
  \edge {SigmaZ} {Zhat};
  \edge {ThetaW} {SW};
  \edge {SigmaW} {What};
  \edge {muZ} {Zhat};
  \edge {muW} {What};
  \edge[opacity=0.4] {Tau2} {Y}

  \factoredge {SZ, Zhat} {crossZ} {Z};
  \factoredge {SW, What} {crossW} {W};


  % Plates
  % cluster plate
  \plate {plateC} {(muZ)(muW)} {$C$};
  \plate[color=colN, fill=colN, fill opacity=0.1] {plateN} {(Y)(Z)(crossZ)(Zhat)(SZ)} {\color{colN} $N$};
  \plate[color=colD ,fill=colD, fill opacity=0.1] {plateD} {(Y)(W)(Tau)(crossW)(What)(SW)(plateN.south east)} {\color{colD}$D_m$};
  \plate[color=colM,fill=colM, fill opacity=0.1] {plateM} {(plateD)(ThetaW) (muW)} {\color{colM}$M$};
  \plate[] {plateK} {(Z)(W)(SZ)(Zhat)(SW)(What)(ThetaZ)(ThetaW)(muW) (plateN.north west) (plateM.north east) (plateD.north east) (plateC)} {$K$};

\end{tikzpicture}
