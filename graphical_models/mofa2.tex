% % \input{colours}

% \begin{tikzpicture}
%   % Define nodes:
%   % matrix factorisation level
%   \node[obs]   (Y) {$y_{n,d}^m$};
%   \node[latent, above=of Y, xshift=-1.5cm] (Z) {$z_{n,k}$};
%   \node[latent, above=of Y, xshift=1.5cm] (W) {$w_{k,d}^m$};
%   \node[latent, xshift=1.5cm] (Tau) {$\tau_{d}^m$};

%   % parents of Z
%   \node[det, above=of Z] (crossZ) {$\times$};
%   \node[latent, above=of crossZ] (Zhat) {$\hat{z}_{n,k}^{\ }$};
%   \node[latent, above=of Zhat] (SigmaZ) {$\alpha_k$};
%   \node[latent, above=of crossZ, xshift=-1.5cm] (SZ) {$s_{n,k}$};
%   \node[latent, above=of SZ] (ThetaZ) {$\theta_{k}$};

%   % parents of W
%   \node[det, above=of W] (crossW) {$\times$};
%   \node[latent, above=of crossW] (What) {$\hat{w}_{k,d}^m$};
%   \node[latent, above=of What] (SigmaW) {$\alpha_k^m$};
%   \node[latent, above=of crossW, xshift=1.5cm] (SW) {$s_{k,d}^m$};
%   \node[latent, above=of SW] (ThetaW) {$\theta_{k}^m$};

%   % Connect the nodes
%   \edge {Z,W, Tau} {Y}; %
%   \edge {ThetaZ} {SZ};
%   \edge {SigmaZ} {Zhat};
%   \edge {ThetaW} {SW};
%   \edge {SigmaW} {What};
%   \factoredge {SZ, Zhat} {crossZ} {Z};
%   \factoredge {SW, What} {crossW} {W};

%   % Plates
%   \plate[] {plateK} {(Z)(W)(SZ)(Zhat)(SW)(What)(ThetaZ)(ThetaW)} {$K$};
%   \plate[] {plateN} {(Y)(Z)(crossZ)(Zhat)(SZ)(plateK.south west)} {$N$};
%   \plate[] {plateD} {(Y)(W)(Tau)(crossW)(What)(SW)(plateK.south east) (plateN.south east)} {$D_m$};
%   \plate[] {plateM} {(plateD)(ThetaW)(plateK.north east)} {$M$};

% \end{tikzpicture}






% model-binomial-probit.tex
%

% Augmented Binomial Probit regression model

%\beginpgfgraphicnamed{model-binomial-probit}

\begin{tikzpicture}
  % Define nodes:
  % matrix factorisation level
  \node[obs]   (Y) {$y_{n,d}^{g,m}$};
  \node[latent, above=of Y, xshift=-1.5cm] (Z) {$z^g_{n,k}$};
  \node[latent, above=of Y, xshift=1.5cm] (W) {$w_{k,d}^m$};
  \node[latent, yshift=-2cm] (Tau) {$\tau_{d}^{g,m}$};
  % \node[latent, densely dashed, yshift=-1.5cm] (TauN) {$\tau_{n}^{m,g}$};

  % \node[opacity=0.4,latent, xshift=-1.5cm] (Tau2) {$\tau_{n}$};

  % parents of Z
  \node[det, above=of Z] (crossZ) {$\times$};
  \node[latent, above=of crossZ] (Zhat) {$\hat{z}^g_{n,k}$};
  \node[latent, above=of Zhat] (SigmaZ) {$\alpha^g_k$};
  \node[latent, above=of crossZ, xshift=-1.5cm] (SZ) {$s^g_{n,k}$};
  \node[latent, above=of SZ] (ThetaZ) {$\theta^g_{k}$};

  % parents of W
  \node[det, above=of W] (crossW) {$\times$};
  \node[latent, above=of crossW] (What) {$\hat{w}_{k,d}^m$};
  \node[latent, above=of What] (SigmaW) {$\alpha_k^m$};
  \node[latent, above=of crossW, xshift=1.5cm] (SW) {$s_{k,d}^m$};
  \node[latent, above=of SW] (ThetaW) {$\theta_{k}^m$};

  % Connect the nodes
  \edge {Z,W} {Y};
  \edge {Tau} {Y};
  \edge {ThetaZ} {SZ};
  \edge {SigmaZ} {Zhat};
  \edge {ThetaW} {SW};
  \edge {SigmaW} {What};
  % \edge[densely dashed] {TauN} {Y}

  \factoredge {SZ} {crossZ} {Z};
  \factoredge {Zhat} {crossZ} {Z};
  \factoredge {SW} {crossW} {W};
  \factoredge {What} {crossW} {W};


  % Plates
  \plate[] {plateK} {(Z)(W)(SZ)(Zhat)(SW)(What)(ThetaZ)(ThetaW)} {$K$};
  
  % \plate[color=yellow] {plateN} {(Y)(Z)(crossZ)(Zhat)(SZ)(plateK.south west)} {$N_g$};
  \plate[] {plateN} {(Y)(Z)(crossZ)(Zhat)(SZ)(plateK.south west)} {$N_g$};
    
   % \plate[color=red] {plateG} {(plateN)(Tau)(plateK.north west)(plateN.south west)} {$G$};
   \plate[] {plateG} {(plateN)(Tau)(plateK.north west)(plateN.south west)} {$G$};
      
  
  % \plate[color=green] {plateD} {(Tau)(Y)(W)(crossW)(What)(SW)(plateK.south east)} {$D_m$};
  \plate[] {plateD} {(Tau)(Y)(W)(crossW)(What)(SW)(plateK.south east)} {$D_m$};
  
  % \plate[color=blue] {plateM} {(plateD)(ThetaW)(plateK.north east)(plateG.north east)} {$M$};
  \plate[] {plateM} {(plateD)(ThetaW)(plateK.north east)(plateG.north east)} {$M$};
  
    
    
\end{tikzpicture}
